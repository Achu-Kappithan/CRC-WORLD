 <%- include("../layouts/user/header.ejs") %>
<style>
.stock-status {
  font-weight: bold;
}

.in-stock {
  color: green;
  font-size: medium;
}

.limited-stock {
  color: orange;
  font-size: medium;
}

.out-of-stock {
  color: red;
  font-size: medium;
}

        .tabs-listing {
            border-bottom: 1px solid #e8e8e8;
            margin: 20px 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        .product-tabs {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            gap: 40px;
        }

        .product-tabs li {
            margin: 0;
            padding: 0;
        }

        .product-tabs .tablink {
            display: inline-block;
            padding: 15px 0;
            color: #333;
            text-decoration: none;
            font-size: 16px;
            font-weight: 500;
            position: relative;
            transition: color 0.3s;
        }

        .product-tabs .tablink:hover {
            color: #000;
        }

        .product-tabs .tablink::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #000;
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .product-tabs li.active .tablink::after {
            transform: scaleX(1);
        }

</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/elevatezoom/3.0.8/jquery.elevatezoom.min.js"></script>

        <!--Body Content-->
        <div id="page-content">
            <!--MainContent-->
            <div id="MainContent" class="main-content" role="main">
                <!--Breadcrumb-->
                <div class="bredcrumbWrap">
                    <div class="container-fluid breadcrumbs">
                        <a href="index.html" title="Back to the home page">Home</a><span aria-hidden="true">›</span><span>Product Layout Style3</span>
                    </div>
                </div>
                <!--End Breadcrumb-->
                
                <div id="ProductSection-product-template" class="product-template__container prstyle3 container-fluid">
                    <!--#ProductSection-product-template-->
                    <div class="product-single product-single-1">
                    	<div class="left-content-product">

                        <% if (productdata.is_deleted) { %>
                          <!-- Display message at the top -->
                          <div style="color: red; font-weight: bold; text-align: center; margin-bottom: 20px;">
                            This product is unavailable.
                          </div>
                        
                          <!-- Add a semi-transparent overlay -->
                          <div style="position: relative;">
                            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.5); z-index: 2;"></div>
                            <div style="pointer-events: none;">
                              <div class="row">

                                <div class="col-lg-6 col-md-6 col-sm-12 col-12">
                                  <div class="product-details-img product-single__photos bottom">
                                      <div class="zoompro-wrap product-zoom-right pl-20">
                                          <div style="height: 500px; width: 500px;" class="zoompro-span">
                                              <img id="main-zoom-image" class="blur-up lazyload zoompro"
                                                  zoomimage="/assets/uploads/product/<%= productdata.productimage[0] %>"
                                                  src="/assets/uploads/product/<%= productdata.productimage[0] %>" />
                                          </div>
                                          <div class="product-labels">
                                              <span class="lbl on-sale">Sale</span>
                                              <span class="lbl pr-label1">new</span>
                                          </div>
                                      </div>
                                      
                                      <div class="product-thumb product-thumb-1">
                                          <div id="image-gallery" class="product-dec-slider-1 product-tab-left">
                                              <% productdata.productimage.forEach((image, index) => { %>
                                                  <a href="" class="thumb-image" 
                                                    data-image="/assets/uploads/product/<%= image %>"
                                                    data-zoom-image="/assets/uploads/product/<%= image %>">
                                                   <img class="blur-up lazyload" 
                                                   src="/assets/uploads/product/<%= image %>" 
                                                     alt="Thumbnail Image" />
                                                  </a>
                                              <% }) %>
                                          </div>
                                      </div>                                        
                                      <div class="lightboximages">
                                      </div>
          
                                  </div>
                              </div>

                              <div class="col-lg-6 col-md-6 col-sm-12 col-12">
                                <div class="product-single__meta">
                                    <h1 class="product-single__title"><%= productdata.productname %></h1>
                                    <div class="product-nav clearfix">
                                      <a href="#" class="next" title="Next"><i class="fa fa-angle-right" aria-hidden="true"></i></a>
                                    </div>
                                    <div class="prInfoRow">
                                      <div class="product-stock">
                                        <span id="stock-status"></span>
                                        <p>Stock : <span id="product-stock"><%= productdata.sizes[0].stock %></span></p>
                                      </div>
                                      <!-- <div class="product-sku">SKU: <span class="variant-sku">19115-rdxs</span></div> -->
                                      <div class="product-review">
                                        <a class="reviewLink" href="#tab2">
                                          <i class="font-13 fa fa-star"></i><i class="font-13 fa fa-star"></i><i class="font-13 fa fa-star"></i>
                                          <i class="font-13 fa fa-star-o"></i><i class="font-13 fa fa-star-o"></i>
                                          <span class="spr-badge-caption">6 reviews</span>
                                        </a>
                                      </div>
                                    </div>
                                     <p class="product-single__price product-single__price-product-template">
                                        <span class="visually-hidden">Regular price</span>
                                        <s style="display: none;" id="ComparePrice-product-template"><span id="salesprice" class="money"><%= productdata.sizes[0].Actualprice%></span></s>
                                        <% if(productdata.sizes[0].Actualprice !== productdata.sizes[0].priceafteroffer){ %>
                                        <s id="ComparePrice-product-template"><span id="salespriceview" class="money"><%= productdata.sizes[0].Actualprice%></span></s>
                                        <% } %>

                                        <span class="product-price__price product-price__price-product-template product-price__sale product-price__sale--single">

                                          <% let price = 0 
                                          if(productdata.sizes[0].priceafteroffer !== undefined && productdata.sizes[0].priceafteroffer > 0){
                                            price = productdata.sizes[0].priceafteroffer
                                          }else{
                                            price =  productdata.sizes[0].Actualprice
                                          }  %>
                                            <span id="ProductPrice-product-template">₹<span class="money" id="product-price"><%= price %> </span></span>
                                        </span>
                                        <% if( productdata.sizes[0].Actualprice !== productdata.sizes[0].priceafteroffer){ %>
                                        <span class="discount-badge"> <span class="devider">|</span>&nbsp;
                                            <span>You Save</span> 
                                            <span  class="product-single__save-amount">
                                            <span id="SaveAmount" class="money"></span>
                                            </span>
                                            <span class="off">(<span id="discount-percentage" ></span>%)</span>
                                        </span> 
                                        <% } %> 
                                    </p>
                                    <div  class="product-single__description rte">
                                    <ul>
                                        <li><h3>Product Detailas</h3></li>
                                        <% if (productdata.productdescription) { %>
                                            <ul>
                                                <% productdata.productdescription.split('\n').forEach(function(point) { %>
                                                    <% if (point.trim()) { %>
                                                        <li><%= point.trim() %></li>
                                                    <% } %>
                                                <% }) %>
                                            </ul>
                                        <% } %>
                                    </ul>
                                </div>
                                <!-- <div id="quantity_message">Hurry! Only  <span class="items">4</span>  left in stock.</div> -->
                                <form method="post" action="http://annimexweb.com/cart/add" id="product_form_10508262282" accept-charset="UTF-8" class="product-form product-form-product-template hidedropdown" enctype="multipart/form-data">
                                    <div class="swatch clearfix swatch-0 option1" data-option-index="0">
                                    </div>
                                    <div class="swatch clearfix swatch-1 option2" data-option-index="1">

                                        <div class="product-form__item">
                                            <label class="header">Size: <span class="slVariant">Select Size</span></label>
                                            <% for (let i = 0; i < productdata.sizes.length; i++) { %>
                                              <div data-value="<%= productdata.sizes[i].size %>" class="swatch-element available">
                                                <input
                                                  class="swatchInput"
                                                  id="swatch-<%= i %>-<%= productdata.sizes[i].size %>"
                                                  type="radio"
                                                  name="size-option"
                                                  value="<%= productdata.sizes[i].size %>"
                                                  data-price="<%= productdata.sizes[i].Actualprice %>"
                                                  data-stock="<%= productdata.sizes[i].stock %>"
                                                  onchange="handleSizeChange('<%= productdata.sizes[i]._id %>', this)"
                                                  <% if (i === 0) { %> checked <% } %> 
                                                >
                                                <label id="sizelabel" class="swatchLbl small flat" for="swatch-<%= i %>-<%= productdata.sizes[i].size %>" title="<%= productdata.sizes[i].size %>">
                                                  <%= productdata.sizes[i].size %>
                                                </label>
                                              </div>
                                            <% } %>
                                        </div>
                                    </div>
                                  </form> 
                                    <!-- Product Action -->
                                    <div class="product-action clearfix">
                                        <div class="product-form__item--quantity">
                                            <div style="text-align: center;">
                                                <div style="display: flex; align-items: center; justify-content: center; gap: 20px;">
                                                    <button id="decrementBtn" style="font-size: 24px; width: 40px; height: 40px; background-color: #ff4d4d; color: white; border: none; border-radius: 50%; cursor: pointer;">-</button>
                                                    <span id="countDisplay" style="font-size: 24px; font-weight: bold; min-width: 50px; text-align: center;">0</span>
                                                    <button id="incrementBtn" style="font-size: 24px; width: 40px; height: 40px; background-color: #4CAF50; color: white; border: none; border-radius: 50%; cursor: pointer;">+</button>
                                                </div>
                                            </div>
                                                                                         
                                        </div>  
                                                                  
                                        <div class="product-form__item--submit">
                                            <button id="addToCart_<%= productdata._id%>" class="btn btn-addto-cart" tabindex="0" data-product-id="<%= productdata._id%>">
                                                Add To Cart
                                            </button>

                                        </div>
                                        <div class="shopify-payment-button" data-shopify="payment-button">
                                            <!-- <button type="button" class="shopify-payment-button__button shopify-payment-button__button--unbranded">Buy it now</button> -->
                                        <hr>
                                        </div>
                                    </div>
                                    <!-- End Product Action -->
                                
                                    <div class="display-table shareRow">
                                        <div class="display-table-cell medium-up--one-third">
                                            <div class="wishlist-btn">
                                                <a class="wishlist add-to-wishlist"  id="wishlist" title="Add to Wishlist"><i class="icon anm anm-heart-l" aria-hidden="true"></i> <span>Add to Wishlist</span></a>
                                                <input type="hidden" id="itemid" value="<%= productdata._id%>">
                                            </div>
                                        </div>
                                        <div class="display-table-cell text-right">
                                            <div class="social-sharing">
                                                <a target="_blank" href="#" class="btn btn--small btn--secondary btn--share share-facebook" title="Share on Facebook">
                                                    <i class="fa fa-facebook-square" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">Share</span>
                                                </a>
                                                <a target="_blank" href="#" class="btn btn--small btn--secondary btn--share share-twitter" title="Tweet on Twitter">
                                                    <i class="fa fa-twitter" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">Tweet</span>
                                                </a>
                                                <a href="#" title="Share on google+" class="btn btn--small btn--secondary btn--share" >
                                                    <i class="fa fa-google-plus" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">Google+</span>
                                                </a>
                                                <a target="_blank" href="#" class="btn btn--small btn--secondary btn--share share-pinterest" title="Pin on Pinterest">
                                                    <i class="fa fa-pinterest" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">Pin it</span>
                                                </a>
                                                <a href="#" class="btn btn--small btn--secondary btn--share share-pinterest" title="Share by Email" target="_blank">
                                                    <i class="fa fa-envelope" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">Email</span>
                                                </a>
                                             </div>
                                        </div>
                                    </div>
                                <div class="product-info">
                                  <p class="product-type"><span class="lbl">Product Brand:</span> <a href="" title="Women's"><%= productdata.brand.name %></a></p>
                                  <p class="product-cat"> <span class="lbl">Product category: </span><a href="" title=""><%= productdata.category.name %></a> </p>
                                </div>
                            </div>
                            </div>
                              </div>
                            </div>
                          </div>
                        <% } else { %>

                            <div class="row">
                                <div class="col-lg-6 col-md-6 col-sm-12 col-12">
                                    <div class="product-details-img product-single__photos bottom">
                                        <div class="zoompro-wrap product-zoom-right pl-20">
                                            <div style="height: 500px; width: 500px;" class="zoompro-span">
                                                <img id="main-zoom-image" class="blur-up lazyload zoompro"
                                                    zoomimage="/assets/uploads/product/<%= productdata.productimage[0] %>"
                                                    src="/assets/uploads/product/<%= productdata.productimage[0] %>" />
                                            </div>
                                            <div class="product-labels">
                                                <span class="lbl on-sale">Sale</span>
                                                <span class="lbl pr-label1">new</span>
                                            </div>
                                        </div>
                                        
                                        <div class="product-thumb product-thumb-1">
                                            <div id="image-gallery" class="product-dec-slider-1 product-tab-left">
                                                <% productdata.productimage.forEach((image, index) => { %>
                                                    <a href="" class="thumb-image" 
                                                      data-image="/assets/uploads/product/<%= image %>"
                                                      data-zoom-image="/assets/uploads/product/<%= image %>">
                                                     <img class="blur-up lazyload" 
                                                     src="/assets/uploads/product/<%= image %>" 
                                                       alt="Thumbnail Image" />
                                                    </a>
                                                <% }) %>
                                            </div>
                                        </div>                                        
                                        <div class="lightboximages">
                                        </div>
            
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12 col-12">
                                    <div class="product-single__meta">
                                        <h1 class="product-single__title"><%= productdata.productname %></h1>
                                        <div class="product-nav clearfix">
                                          <a href="#" class="next" title="Next"><i class="fa fa-angle-right" aria-hidden="true"></i></a>
                                        </div>
                                        <div class="prInfoRow">
                                          <div class="product-stock">
                                            <span id="stock-status"></span>
                                            <p>Stock : <span id="product-stock"><%= productdata.sizes[0].stock %></span></p>
                                          </div>
                                          <div class="product-review">
                                            <a class="reviewLink" href="#tab2">
                                              <i class="font-13 fa fa-star"></i><i class="font-13 fa fa-star"></i><i class="font-13 fa fa-star"></i>
                                              <i class="font-13 fa fa-star-o"></i><i class="font-13 fa fa-star-o"></i>
                                              <span class="spr-badge-caption">6 reviews</span>
                                            </a>
                                          </div>
                                        </div>

                                        <p class="product-single__price product-single__price-product-template">
                                          <span class="visually-hidden">Regular price</span>
                                        
                                          <% if (productdata.sizes[0].Actualprice !== productdata.sizes[0].priceafteroffer) { %>
                                            <s id="ComparePrice-product-template">
                                              <span id="salesprice" class="money">₹<%= productdata.sizes[0].Actualprice %></span>
                                            </s>
                                          <% } %>
                                        
                                          <span class="product-price__price product-price__price-product-template product-price__sale product-price__sale--single">
                                            <% let finalprice = productdata.sizes[0].priceafteroffer && productdata.sizes[0].priceafteroffer > 0 
                                                ? productdata.sizes[0].priceafteroffer 
                                                : productdata.sizes[0].Actualprice; %>
                                            <span id="ProductPrice-product-template">₹<span class="money" id="product-price"><%= finalprice %></span></span>
                                          </span>
                                        
                                          <% if (productdata.sizes[0].Actualprice !== productdata.sizes[0].priceafteroffer) { %>
                                            <span class="discount-badge"> 
                                              <span class="devider">|</span>&nbsp;
                                              <span>You Save</span>
                                              <span class="product-single__save-amount">
                                                <span id="SaveAmount" class="money">
                                                  <% let savings = productdata.sizes[0].Actualprice - productdata.sizes[0].priceafteroffer; %>
                                                  ₹<%= savings %>
                                                </span>
                                              </span>
                                              <span class="off">(<span id="discount-percentage">
                                                <% let discountPercentage = Math.round((savings / productdata.sizes[0].Actualprice) * 100); %>
                                                <%= discountPercentage %>
                                              </span>%)</span>
                                            </span>
                                          <% } %> 
                                        </p>
                                        



                                        <div  class="product-single__description rte">
                                        <ul>
                                            <li><h3>Product Detailas</h3></li>
                                            <% if (productdata.productdescription) { %>
                                                <ul>
                                                    <% productdata.productdescription.split('\n').forEach(function(point) { %>
                                                        <% if (point.trim()) { %>
                                                            <li><%= point.trim() %></li>
                                                        <% } %>
                                                    <% }) %>
                                                </ul>
                                            <% } %>
                                        </ul>
                                    </div>
                                    <!-- <div id="quantity_message">Hurry! Only  <span class="items">4</span>  left in stock.</div> -->
                                    <form method="post" action="http://annimexweb.com/cart/add" id="product_form_10508262282" accept-charset="UTF-8" class="product-form product-form-product-template hidedropdown" enctype="multipart/form-data">
                                        <div class="swatch clearfix swatch-0 option1" data-option-index="0">
                                        </div>
                                        <div class="swatch clearfix swatch-1 option2" data-option-index="1">

                                            <div class="product-form__item">
                                                <label class="header">Size: <span class="slVariant">Select Size</span></label>
                                                <% for (let i = 0; i < productdata.sizes.length; i++) { %>
                                                  <div data-value="<%= productdata.sizes[i].size %>" class="swatch-element available">
                                                    <input
                                                      class="swatchInput"
                                                      id="swatch-<%= i %>-<%= productdata.sizes[i].size %>"
                                                      type="radio"
                                                      name="size-option"
                                                      value="<%= productdata.sizes[i].size %>"
                                                      data-price="<%= productdata.sizes[i].Actualprice %>"
                                                      data-stock="<%= productdata.sizes[i].stock %>"
                                                      onchange="handleSizeChange('<%= productdata.sizes[i]._id %>', this)"
                                                      <% if (i === 0) { %> checked <% } %> 
                                                    >
                                                    <label id="sizelabel" class="swatchLbl small flat" for="swatch-<%= i %>-<%= productdata.sizes[i].size %>" title="<%= productdata.sizes[i].size %>">
                                                      <%= productdata.sizes[i].size %>
                                                    </label>
                                                  </div>
                                                <% } %>
                                            </div>
                                        </div>
                                      </form> 
                                        <!-- Product Action -->
                                        <div class="product-action clearfix">
                                            <div class="product-form__item--quantity">
                                                <div style="text-align: center;">
                                                    <div style="display: flex; align-items: center; justify-content: center; gap: 20px;">
                                                        <button id="decrementBtn" style="font-size: 24px; width: 40px; height: 40px; background-color: #ff4d4d; color: white; border: none; border-radius: 50%; cursor: pointer;">-</button>
                                                        <span id="countDisplay" style="font-size: 24px; font-weight: bold; min-width: 50px; text-align: center;">0</span>
                                                        <button id="incrementBtn" style="font-size: 24px; width: 40px; height: 40px; background-color: #4CAF50; color: white; border: none; border-radius: 50%; cursor: pointer;">+</button>
                                                    </div>
                                                </div>
                                                                                             
                                            </div>  
                                                                      
                                            <div class="product-form__item--submit">
                                                <button id="addToCart_<%= productdata._id%>" class="btn btn-addto-cart" tabindex="0" data-product-id="<%= productdata._id%>">
                                                    Add To Cart
                                                </button>

                                            </div>
                                            <div class="shopify-payment-button" data-shopify="payment-button">
                                                <!-- <button type="button" class="shopify-payment-button__button shopify-payment-button__button--unbranded">Buy it now</button> -->
                                            <hr>
                                            </div>
                                        </div>
                                        <!-- End Product Action -->
                                    
                                        <div class="display-table shareRow">
                                            <div class="display-table-cell medium-up--one-third">
                                                <div class="wishlist-btn">
                                                    <a class="wishlist add-to-wishlist"  id="wishlist" title="Add to Wishlist"><i class="icon anm anm-heart-l" aria-hidden="true"></i> <span>Add to Wishlist</span></a>
                                                    <input type="hidden" id="itemid" value="<%= productdata._id%>">
                                                </div>
                                            </div>
                                            <div class="display-table-cell text-right">
                                                <div class="social-sharing">
                                                    <a target="_blank" href="#" class="btn btn--small btn--secondary btn--share share-facebook" title="Share on Facebook">
                                                        <i class="fa fa-facebook-square" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">Share</span>
                                                    </a>
                                                    <a target="_blank" href="#" class="btn btn--small btn--secondary btn--share share-twitter" title="Tweet on Twitter">
                                                        <i class="fa fa-twitter" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">Tweet</span>
                                                    </a>
                                                    <a href="#" title="Share on google+" class="btn btn--small btn--secondary btn--share" >
                                                        <i class="fa fa-google-plus" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">Google+</span>
                                                    </a>
                                                    <a target="_blank" href="#" class="btn btn--small btn--secondary btn--share share-pinterest" title="Pin on Pinterest">
                                                        <i class="fa fa-pinterest" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">Pin it</span>
                                                    </a>
                                                    <a href="#" class="btn btn--small btn--secondary btn--share share-pinterest" title="Share by Email" target="_blank">
                                                        <i class="fa fa-envelope" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">Email</span>
                                                    </a>
                                                 </div>
                                            </div>
                                        </div>
                                    <div class="product-info">
                                      <p class="product-type"><span class="lbl">Product Brand:</span> <a href="" title="Women's"><%= productdata.brand.name %></a></p>
                                      <p class="product-cat"> <span class="lbl">Product category: </span><a href="" title=""><%= productdata.category.name %></a> </p>
                                    </div>
                                </div>
                                </div>
                              </div>

                              <% } %>
                                <!--Product Tabs-->
                                <div class="tabs-listing">
                                    <ul class="product-tabs">
                                        <li rel="tab4"><a class="tablink">Shipping &amp; Returns</a></li>
                                    </ul>
                                    <div class="tab-container">
                                        
                                        
                                        <div id="tab4" class="tab-content">
                                            <h4>Returns Policy</h4>
                                            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce eros justo, accumsan non dui sit amet. Phasellus semper volutpat mi sed imperdiet. Ut odio lectus, vulputate non ex non, mattis sollicitudin purus. Mauris consequat justo a enim interdum, in consequat dolor accumsan. Nulla iaculis diam purus, ut vehicula leo efficitur at.</p>
                                            <p>Interdum et malesuada fames ac ante ipsum primis in faucibus. In blandit nunc enim, sit amet pharetra erat aliquet ac.</p>
                                            <h4>Shipping</h4>
                                            <p>Pellentesque ultrices ut sem sit amet lacinia. Sed nisi dui, ultrices ut turpis pulvinar. Sed fringilla ex eget lorem consectetur, consectetur blandit lacus varius. Duis vel scelerisque elit, et vestibulum metus.  Integer sit amet tincidunt tortor. Ut lacinia ullamcorper massa, a fermentum arcu vehicula ut. Ut efficitur faucibus dui Nullam tristique dolor eget turpis consequat varius. Quisque a interdum augue. Nam ut nibh mauris.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    	<!--End-product-single-->
                        <!--Product Sidebar-->
                        <div class="prSidebar sidebar-product">
                    		<div class="col-lg-12 col-md-12 col-sm-12 col-12">

                                <div class="related-product grid-products">
                                	<header class="section-header">
                                        <h2 class="section-header__title text-center h2"><span>Related Products</span></h2>
                                        <p class="sub-heading">You can stop autoplay, increase/decrease aniamtion speed and number of grid to show and products from store admin.</p>
                                    </header>
                                    <div class="grid">
                                        <% relatedproducts.forEach(item=>{ %>
                                        <div class="grid__item">
                                          <div class="mini-list-item">
                                            <div class="mini-view_image">
                                                <a class="grid-view-item__link" href="/load_productview?id=<%= item._id %>">
                                                    <img class="grid-view-item__image" src="/assets/uploads/product/<%= item.productimage[0] %>" alt="">
                                                </a>
                                            </div>
                                            <div class="details">
                                            	<a class="grid-view-item__title" href="#"><%= item.productname %></a>
                                                <% let price = item.sizes.find(size => size.Actualprice > 0)?.Actualprice %>
                                              	<div class="grid-view-item__meta"><span class="product-price__price"><span class="money"></span><%= priceHelper(item.sizes) %></span></div>
                                                <div class="product-review">
                                                    <i class="font-13 fa fa-star"></i>
                                                    <i class="font-13 fa fa-star"></i>
                                                    <i class="font-13 fa fa-star"></i>
                                                    <i class="font-13 fa fa-star"></i>
                                                    <i class="font-13 fa fa-star"></i>
                                                </div>
                                            </div>
                                          </div>
                                        </div>
                                        <% }) %>
                                     </div> 
                                </div>
                                <!--Product Feature-->

                                <div class="prFeatures">
                                    <div class="row">
                                        <div class="feature">
                                            <img src="assets/images/credit-card.png" alt="Safe Payment" title="Safe Payment" />
                                            <div class="details"><h5>Safe Payment</h5>Pay with the world's most payment methods.</div>
                                        </div>
                                        <div class="feature">
                                            <img src="assets/images/shield.png" alt="Confidence" title="Confidence" />
                                            <div class="details"><h5>Confidence</h5>Protection covers your purchase and personal data.</div>
                                        </div>
                                        <div class="feature">
                                            <img src="assets/images/worldwide.png" alt="Worldwide Delivery" title="Worldwide Delivery" />
                                            <div class="details"><h5>Worldwide Delivery</h5>FREE &amp; fast shipping to over 200+ countries &amp; regions.</div>
                                        </div>
                                        <div class="feature">
                                            <img src="assets/images/phone-call.png" alt="Hotline" title="Hotline" />
                                            <div class="details"><h5>Hotline</h5>Talk to help line for your question on 4141 456 789, 4125 666 888</div>
                                        </div>
                                    </div>
                                </div>
                                <!--End Product Feature-->

                               	<!--End Recently Viewed Product-->
                            </div>
                        </div>
                        <!--Product Sidebar-->
                    </div>
                	<!--#ProductSection-product-template-->
            	</div>
            <!--MainContent-->
        </div>
    	<!--End Body Content-->

        


<%- include("../layouts/user/footer.ejs") %> 


<script>

    // product zoom

    $(document).ready(function() {
    function initZoom() {
        $('#main-zoom-image').elevateZoom({
            zoomType: "lens",
            lensShape: "round",
            lensSize: 200,
            scrollZoom: true
        });
    }
    initZoom();

    $('#image-gallery').on('click', 'a.thumb-image', function(e) {
        e.preventDefault();

        var newImage = $(this).attr('data-image');
        var newZoomImage = $(this).attr('data-zoom-image');
        console.log("neq",newImage)
        console.log("zoom",newZoomImage)

        $('#main-zoom-image').attr('src', newImage);
        $('#main-zoom-image').attr('zoomimage', newZoomImage);

        // $('.zoomContainer').remove();
        // $('#main-zoom-image').removeData('elevateZoom');

        initZoom();
    });
});




  function handleSizeChange(sizeId, inputElement) {
  const selectedSize = inputElement.value;
  console.log("Selected Size:", selectedSize);

  updateProductDetails(sizeId);
}

function updateProductDetails(sizeId) {
  fetch(`/get-size-details?id=${sizeId}`)
    .then((response) => {
      if (!response.ok) {
        throw new Error("Failed to fetch size details. Server returned an error.");
      }
      return response.json();
    })
    .then((data) => {
      if (data.success) {
        console.log(data);

        let savings = data.size.Actualprice - data.size.priceafteroffer;
        console.log("savingamt ", savings);
        let discountPercentage = (savings / data.size.Actualprice) * 100;
        console.log("percentAGE", discountPercentage);

        let price = 0;
        if (data.size.priceafteroffer !== undefined && data.size.priceafteroffer > 0) {
          price = data.size.priceafteroffer;
        } else {
          price = data.size.Actualprice;
        }

        // Check if elements exist before updating
        const productPriceElement = document.getElementById("product-price");
        const productStockElement = document.getElementById("product-stock");
        const salesPriceElement = document.getElementById("salesprice");
        const salesPriceViewElement = document.getElementById("salespriceview");
        const saveAmountElement = document.getElementById("SaveAmount");
        const discountPercentageElement = document.getElementById("discount-percentage");
        const stockStatusElement = document.getElementById("stock-status");

        if (productPriceElement) productPriceElement.textContent = Math.round(price);
        if (productStockElement) productStockElement.textContent = data.size.stock;
        if (salesPriceElement) salesPriceElement.textContent = data.size.Actualprice;
        if (salesPriceViewElement) salesPriceViewElement.textContent = data.size.Actualprice;
        if (saveAmountElement) saveAmountElement.textContent = Math.round(savings);
        if (discountPercentageElement) discountPercentageElement.textContent = Math.round(discountPercentage);

        // Handle stock status
        const stock = data.size.stock;
        if (stockStatusElement) {
          if (stock > 5) {
            stockStatusElement.textContent = "In Stock";
            stockStatusElement.className = "stock-status in-stock";
          } else if (stock > 0 && stock <= 5) {
            stockStatusElement.textContent = "Limited Stock";
            stockStatusElement.className = "stock-status limited-stock";
          } else {
            stockStatusElement.textContent = "Out of Stock";
            stockStatusElement.className = "stock-status out-of-stock";
          }
        }
      } else {
        alert("Failed to fetch size details. Please try again.");
      }
    })
    .catch((error) => {
      console.error("Error fetching size details:", error);
    });
}

window.onload = function () {
  const defaultSizeId = "<%= productdata.sizes[0]._id %>";
  updateProductDetails(defaultSizeId);
};






  document.querySelectorAll("[id^='addToCart_']").forEach(button => {
  button.addEventListener("click", function() {
    const productId = this.dataset.productId;
    const priceElement = document.getElementById("product-price");
    const Offerprice = priceElement.textContent;
    console.log("offerprice",Offerprice)  
    const countDisplay = document.getElementById('countDisplay');
    const quantity = parseInt(countDisplay.textContent);
    const stockElement = document.getElementById("product-stock");
    const stock = parseInt(stockElement.textContent);
    const salespriceElement = document.getElementById('salesprice');
    const Actualprice = salespriceElement ?  salespriceElement.textContent  : Offerprice
    console.log("actual price is ",Actualprice)

    

    const selectedSizeRadio = document.querySelector('input[name="size-option"]:checked');
    const Cartsize = selectedSizeRadio ? selectedSizeRadio.value : null;

    console.log("this is the cart size",Cartsize)

    if (!Cartsize) {
      Swal.fire({
        icon: 'error',
        title: 'Oops...',
        text: 'Please select a size before adding to cart!',
        toast: true,
          background: "black",
            color:"white",
            position: "top-end",
            showConfirmButton: false,
            timerProgressBar: true,
            timer: 3000,
            customClass: {
           popup: 'custom-toast'
    },
    didOpen: () => {
        const swalPopup = document.querySelector('.custom-toast');
        swalPopup.style.marginTop = '70px';  
        swalPopup.style.marginRight = '15px'; 
    }

      });
      return;  
    }

    console.log("This is the selected size:", Cartsize);

    fetch("/addto_cart", {
      method: "POST",
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ productId, quantity, Actualprice, stock, Cartsize, Offerprice }),
    })
    .then(response => response.json())
    .then(data => {
      Swal.fire({
        icon: data.alertType || 'success', 
        title: data.alertTitle || 'Success',
        text: data.alertText || data.message,
        toast: true,
          background: "black",
            color:"white",
            position: "top-end",
            showConfirmButton: false,
            timerProgressBar: true,
            timer: 3000,
            customClass: {
           popup: 'custom-toast'
    },
    didOpen: () => {
        const swalPopup = document.querySelector('.custom-toast');
        swalPopup.style.marginTop = '70px';  
        swalPopup.style.marginRight = '15px'; 
    }

      });
    console.log("updated cartcount",data.count)
    document.getElementById("CartCount").textContent = data.count

    })
    .catch(error => {
      Swal.fire({
        icon: 'error',
        title: 'Oops...',
        text: 'Something went wrong!',
        toast: true,
            position: "top-end",
            showConfirmButton: false,
            timerProgressBar: true,
            timer: 3000,
            customClass: {
           popup: 'custom-toast'
    },
    didOpen: () => {
        const swalPopup = document.querySelector('.custom-toast');
        swalPopup.style.marginTop = '70px';  
        swalPopup.style.marginRight = '15px'; 
    }

      });
      console.error("Error adding product to cart:", error);
    });
  });
});
    
    
// quentity button adjuste


let count = 1;
const countDisplay = document.getElementById('countDisplay');
const incrementBtn = document.getElementById('incrementBtn');
const decrementBtn = document.getElementById('decrementBtn');

function updateDisplay() {
    countDisplay.textContent = count;
}

updateDisplay();

incrementBtn.addEventListener('click', () => {
    if (count < 5) {
        count++;
        updateDisplay();
    }
});

decrementBtn.addEventListener('click', () => {
    if (count > 1) { 
        count--;
        updateDisplay();
    }
});



// for adding wihlist

document.getElementById("wishlist").addEventListener("click",function(){
    const id = document.getElementById("itemid").value
    fetch("/addto_wishlist",{
      method : "POST",
      headers : {
        "Content-Type" : "application/json"
      },
      body : JSON.stringify({id})
    })
    .then(responce =>responce.json())
    .then((data)=>{
      if (data.success) {
                this.classList.toggle('active');
                this.querySelector('i').classList.replace('anm-heart-l', 'anm-heart');
                Swal.fire({
                    icon: 'success',
                    title: 'Added to Wishlist',
                    text: 'Product added to your wishlist!',
                    toast: true,
                    background: "black",
                    color: "white",
                    position: 'bottom-end',
                    showConfirmButton: false,
                    timerProgressBar: true,
                    timer: 3000,
                    customClass: {
                        popup: "custom-toast",
                    },
                    didOpen: () => {
                        const swalPopup = document.querySelector(".custom-toast");
                        swalPopup.style.marginBottom = "70px";
                        swalPopup.style.marginRight = "15px";
                    },
                });
    }else if(data.error){
      Swal.fire({
                    icon: 'warning',
                    title: 'warning',
                    text: 'Item alredy in the wishlist!',
                    toast: true,
                    background: "black",
                    color: "white",
                    position: 'bottom-end',
                    showConfirmButton: false,
                    timerProgressBar: true,
                    timer: 3000,
                    customClass: {
                        popup: "custom-toast",
                    },
                    didOpen: () => {
                        const swalPopup = document.querySelector(".custom-toast");
                        swalPopup.style.marginBottom = "70px";
                        swalPopup.style.marginRight = "15px";
                    },
                });
    }
    })
    .catch((err) => {
            console.log("Error adding item to wishlist: ", err);
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'An error occurred. Please try again.',
                toast: true,
                background: "black",
                color: "white",
                position: 'bottom-end',
                showConfirmButton: false,
                timerProgressBar: true,
                timer: 3000,
                customClass: {
                    popup: "custom-toast",
                },
                didOpen: () => {
                    const swalPopup = document.querySelector(".custom-toast");
                    swalPopup.style.marginBottom = "70px";
                    swalPopup.style.marginRight = "15px";
                },
            });
        });
  })





    
</script>
    
