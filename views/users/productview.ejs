 <%- include("../layouts/user/header.ejs") %>
<style>
.stock-status {
  font-weight: bold;
}

.in-stock {
  color: green;
  font-size: medium;
}

.limited-stock {
  color: orange;
  font-size: medium;
}

.out-of-stock {
  color: red;
  font-size: medium;
}

</style>

        <!--Body Content-->
        <div id="page-content">
            <!--MainContent-->
            <div id="MainContent" class="main-content" role="main">
                <!--Breadcrumb-->
                <div class="bredcrumbWrap">
                    <div class="container-fluid breadcrumbs">
                        <a href="index.html" title="Back to the home page">Home</a><span aria-hidden="true">›</span><span>Product Layout Style3</span>
                    </div>
                </div>
                <!--End Breadcrumb-->
                
                <div id="ProductSection-product-template" class="product-template__container prstyle3 container-fluid">
                    <!--#ProductSection-product-template-->
                    <div class="product-single product-single-1">
                    	<div class="left-content-product">
                            <div class="row">
                                <div class="col-lg-6 col-md-6 col-sm-12 col-12">
                                    <div class="product-details-img product-single__photos bottom">
                                        <div class="zoompro-wrap product-zoom-right pl-20">
                                            <div class="zoompro-span">
                                                <img class="blur-up lazyload zoompro" data-zoom-image="/assets/uploads/product/<%= productdata.productimage[0] %>" alt="" src="/assets/uploads/product/<%= productdata.productimage[0] %>" />
                                            </div>
                                            <div class="product-labels"><span class="lbl on-sale">Sale</span><span class="lbl pr-label1">new</span></div>
                                            <div class="product-buttons">
                                                <a href="https://www.youtube.com/watch?v=93A2jOW5Mog" class="btn popup-video" title="View Video"><i class="icon anm anm-play-r" aria-hidden="true"></i></a>
                                                <a href="#" class="btn prlightbox" title="Zoom"><i class="icon anm anm-expand-l-arrows" aria-hidden="true"></i></a>
                                            </div>
                                        </div>
                                        <div class="product-thumb product-thumb-1">
                                            <div id="gallery" class="product-dec-slider-1 product-tab-left">
                                                <a data-image="/assets/uploads/product/<%= productdata.productimage[0] %>" data-zoom-image="/assets/uploads/product/<%= productdata.productimage[0] %>" class="slick-slide slick-cloned" data-slick-index="-4" aria-hidden="true" tabindex="-1">
                                                    <img class="blur-up lazyload" src="/assets/uploads/product/<%= productdata.productimage[0] %>" alt="" />
                                                </a>
                                                <a data-image="/assets/uploads/product/<%= productdata.productimage[1] %>" data-zoom-image="/assets/uploads/product/<%= productdata.productimage[1] %>" class="slick-slide slick-cloned" data-slick-index="-3" aria-hidden="true" tabindex="-1">
                                                    <img class="blur-up lazyload" src="/assets/uploads/product/<%= productdata.productimage[1] %>" alt="" />
                                                </a>
                                                <a data-image="/assets/uploads/product/<%= productdata.productimage[2] %>" data-zoom-image="/assets/uploads/product/<%= productdata.productimage[2] %>" class="slick-slide slick-cloned" data-slick-index="-2" aria-hidden="true" tabindex="-1">
                                                    <img class="blur-up lazyload" src="/assets/uploads/product/<%= productdata.productimage[2] %>" alt="" />
                                                </a>
                                            </div>
                                        </div>
                                        <div class="lightboximages">
                                        </div>
            
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12 col-12">
                                    <div class="product-single__meta">
                                        <h1 class="product-single__title"><%= productdata.productname %></h1>
                                        <div class="product-nav clearfix">
                                          <a href="#" class="next" title="Next"><i class="fa fa-angle-right" aria-hidden="true"></i></a>
                                        </div>
                                        <div class="prInfoRow">
                                          <div class="product-stock">
                                            <span id="stock-status"></span>
                                            <p>Stock : <span id="product-stock"><%= productdata.sizes[0].stock %></span></p>
                                          </div>
                                          <div class="product-sku">SKU: <span class="variant-sku">19115-rdxs</span></div>
                                          <div class="product-review">
                                            <a class="reviewLink" href="#tab2">
                                              <i class="font-13 fa fa-star"></i><i class="font-13 fa fa-star"></i><i class="font-13 fa fa-star"></i>
                                              <i class="font-13 fa fa-star-o"></i><i class="font-13 fa fa-star-o"></i>
                                              <span class="spr-badge-caption">6 reviews</span>
                                            </a>
                                          </div>
                                        </div>
                                         <p class="product-single__price product-single__price-product-template">
                                            <span class="visually-hidden">Regular price</span>
                                            <s id="ComparePrice-product-template"><span class="money"><%= productdata.sizes[2].Actualprice%></span></s>
                                            <span class="product-price__price product-price__price-product-template product-price__sale product-price__sale--single">
                                                <span id="ProductPrice-product-template">₹<span class="money" id="product-price"><%= productdata.sizes[0].Salesprice %> </span></span>
                                            </span>
                                            <span class="discount-badge"> <span class="devider">|</span>&nbsp;
                                                <span>You Save</span>
                                                <span id="SaveAmount-product-template" class="product-single__save-amount">
                                                <span class="money">$100.00</span>
                                                </span>
                                                <span class="off">(<span>16</span>%)</span>
                                            </span>  
                                        </p>
                                    <div  class="product-single__description rte">
                                        <ul>
                                            <li><h3>Product Detailas</h3></li>
                                            <% if (productdata.productdescription) { %>
                                                <ul>
                                                    <% productdata.productdescription.split('\n').forEach(function(point) { %>
                                                        <% if (point.trim()) { %>
                                                            <li><%= point.trim() %></li>
                                                        <% } %>
                                                    <% }) %>
                                                </ul>
                                            <% } %>
                                        
                                        </ul>
                                    </div>
                                    <div id="quantity_message">Hurry! Only  <span class="items">4</span>  left in stock.</div>
                                    <form method="post" action="http://annimexweb.com/cart/add" id="product_form_10508262282" accept-charset="UTF-8" class="product-form product-form-product-template hidedropdown" enctype="multipart/form-data">
                                        <div class="swatch clearfix swatch-0 option1" data-option-index="0">
                                        </div>
                                        <div class="swatch clearfix swatch-1 option2" data-option-index="1">

                                            <div class="product-form__item">
                                                <label class="header">Size: <span class="slVariant">Select Size</span></label>
                                                <% for (let i = 0; i < productdata.sizes.length; i++) { %>
                                                  <div data-value="<%= productdata.sizes[i].size %>" class="swatch-element available">
                                                    <input
                                                      class="swatchInput"
                                                      id="swatch-<%= i %>-<%= productdata.sizes[i].size %>"
                                                      type="radio"
                                                      name="size-option"
                                                      value="<%= productdata.sizes[i].size %>"
                                                      data-price="<%= productdata.sizes[i].Salesprice %>"
                                                      data-stock="<%= productdata.sizes[i].stock %>"
                                                      onchange="handleSizeChange('<%= productdata.sizes[i]._id %>', this)"
                                                      <% if (i === 0) { %> checked <% } %> 
                                                    >
                                                    <label id="sizelabel" class="swatchLbl small flat" for="swatch-<%= i %>-<%= productdata.sizes[i].size %>" title="<%= productdata.sizes[i].size %>">
                                                      <%= productdata.sizes[i].size %>
                                                    </label>
                                                  </div>
                                                <% } %>
                                            </div>
                                                                                       

                                        </form> 
                                        </div>
                                        <!-- Product Action -->
                                        <div class="product-action clearfix">
                                            <div class="product-form__item--quantity">
                                                <div style="text-align: center;">
                                                    <div style="display: flex; align-items: center; justify-content: center; gap: 20px;">
                                                        <button id="decrementBtn" style="font-size: 24px; width: 40px; height: 40px; background-color: #ff4d4d; color: white; border: none; border-radius: 50%; cursor: pointer;">-</button>
                                                        <span id="countDisplay" style="font-size: 24px; font-weight: bold; min-width: 50px; text-align: center;">0</span>
                                                        <button id="incrementBtn" style="font-size: 24px; width: 40px; height: 40px; background-color: #4CAF50; color: white; border: none; border-radius: 50%; cursor: pointer;">+</button>
                                                    </div>
                                                </div>
                                                                                             
                                            </div>  
                                                                      
                                            <div class="product-form__item--submit">
                                                <button id="addToCart_<%= productdata._id%>" class="btn btn-addto-cart" tabindex="0" data-product-id="<%= productdata._id%>">
                                                    Add To Cart
                                                </button>

                                            </div>
                                            <div class="shopify-payment-button" data-shopify="payment-button">
                                                <button type="button" class="shopify-payment-button__button shopify-payment-button__button--unbranded">Buy it now</button>
                                            </div>
                                        </div>
                                        <!-- End Product Action -->
                                    
                                    <div class="display-table shareRow">
                                            <div class="display-table-cell medium-up--one-third">
                                                <div class="wishlist-btn">
                                                    <a class="wishlist add-to-wishlist" href="#" title="Add to Wishlist"><i class="icon anm anm-heart-l" aria-hidden="true"></i> <span>Add to Wishlist</span></a>
                                                </div>
                                            </div>
                                            <div class="display-table-cell text-right">
                                                <div class="social-sharing">
                                                    <a target="_blank" href="#" class="btn btn--small btn--secondary btn--share share-facebook" title="Share on Facebook">
                                                        <i class="fa fa-facebook-square" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">Share</span>
                                                    </a>
                                                    <a target="_blank" href="#" class="btn btn--small btn--secondary btn--share share-twitter" title="Tweet on Twitter">
                                                        <i class="fa fa-twitter" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">Tweet</span>
                                                    </a>
                                                    <a href="#" title="Share on google+" class="btn btn--small btn--secondary btn--share" >
                                                        <i class="fa fa-google-plus" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">Google+</span>
                                                    </a>
                                                    <a target="_blank" href="#" class="btn btn--small btn--secondary btn--share share-pinterest" title="Pin on Pinterest">
                                                        <i class="fa fa-pinterest" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">Pin it</span>
                                                    </a>
                                                    <a href="#" class="btn btn--small btn--secondary btn--share share-pinterest" title="Share by Email" target="_blank">
                                                        <i class="fa fa-envelope" aria-hidden="true"></i> <span class="share-title" aria-hidden="true">Email</span>
                                                    </a>
                                                 </div>
                                            </div>
                                        </div>
                                    <div class="product-info">
                                      <p class="product-type"><span class="lbl">Product Type:</span> <a href="http://annimexweb.com/collections/types?q=Women%27s" title="Women's">Women's</a></p>
                                      <p class="product-cat"> <span class="lbl">Collections: </span><a href="http://annimexweb.com/collections/notifications" title="">Product Notifications</a> <a href="http://annimexweb.com/collections/women" title="">Women</a> </p>
                                    </div>
                                </div>
                                </div>
                                <!--Product Tabs-->
                                <!--End Product Tabs-->
                            </div>
                        </div>
                    	<!--End-product-single-->
                        <!--Product Sidebar-->
                        <div class="prSidebar sidebar-product">
                    		<div class="col-lg-12 col-md-12 col-sm-12 col-12">
                                <!--Product Feature-->
                                <div class="prFeatures">
                                    <div class="row">
                                        <div class="feature">
                                            <img src="assets/images/credit-card.png" alt="Safe Payment" title="Safe Payment" />
                                            <div class="details"><h5>Safe Payment</h5>Pay with the world's most payment methods.</div>
                                        </div>
                                        <div class="feature">
                                            <img src="assets/images/shield.png" alt="Confidence" title="Confidence" />
                                            <div class="details"><h5>Confidence</h5>Protection covers your purchase and personal data.</div>
                                        </div>
                                        <div class="feature">
                                            <img src="assets/images/worldwide.png" alt="Worldwide Delivery" title="Worldwide Delivery" />
                                            <div class="details"><h5>Worldwide Delivery</h5>FREE &amp; fast shipping to over 200+ countries &amp; regions.</div>
                                        </div>
                                        <div class="feature">
                                            <img src="assets/images/phone-call.png" alt="Hotline" title="Hotline" />
                                            <div class="details"><h5>Hotline</h5>Talk to help line for your question on 4141 456 789, 4125 666 888</div>
                                        </div>
                                    </div>
                                </div>
                                <!--End Product Feature-->
                                <div class="related-product grid-products">
                                	<header class="section-header">
                                        <h2 class="section-header__title text-center h2"><h2>CrC World</h2></h2>
                                        <p class="sub-heading">You can manage this section from store admin as describe in above section</p>
                                    </header>
                                    <div class="grid">
                                        
                                </div>
                               	<!--End Recently Viewed Product-->
                            </div>
                        </div>
                        <!--Product Sidebar-->
                    </div>
                	<!--#ProductSection-product-template-->
            	</div>
            <!--MainContent-->
        </div>
    	<!--End Body Content-->

        


<%- include("../layouts/user/footer.ejs") %> 


<script>



  function handleSizeChange(sizeId, inputElement) {
      const selectedSize = inputElement.value;
      console.log("Selected Size:", selectedSize);

      updateProductDetails(sizeId);
  }

  function updateProductDetails(sizeId) {
      fetch(`/get-size-details?id=${sizeId}`)
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            document.getElementById('product-price').textContent = data.size.Salesprice;
            document.getElementById('product-stock').textContent = data.size.stock;
  
            const stockStatusElement = document.getElementById('stock-status');
            const stock = data.size.stock;
  
            if (stock > 5) {
              stockStatusElement.textContent = 'In Stock';
              stockStatusElement.className = 'stock-status in-stock';
            } else if (stock > 0 && stock <= 5) {
              stockStatusElement.textContent = 'Limited Stock';
              stockStatusElement.className = 'stock-status limited-stock';
            } else {
              stockStatusElement.textContent = 'Out of Stock';
              stockStatusElement.className = 'stock-status out-of-stock';
            }
          } else {
            alert('Failed to fetch size details. Please try again.');
          }
        })
        .catch(error => console.error('Error fetching size details:', error));
  }

  window.onload = function() {
      const defaultSizeId = '<%= productdata.sizes[0]._id %>';  
      updateProductDetails(defaultSizeId);  
  };





  document.querySelectorAll("[id^='addToCart_']").forEach(button => {
  button.addEventListener("click", function() {
    const productId = this.dataset.productId;
    const priceElement = document.getElementById("product-price");
    const Salesprice = priceElement.textContent;
    const countDisplay = document.getElementById('countDisplay');
    const quantity = parseInt(countDisplay.textContent);
    const stockElement = document.getElementById("product-stock");
    const stock = parseInt(stockElement.textContent);

    const selectedSizeRadio = document.querySelector('input[name="size-option"]:checked');
    const Cartsize = selectedSizeRadio ? selectedSizeRadio.value : null;

    console.log("this is the cart size",Cartsize)

    if (!Cartsize) {
      Swal.fire({
        icon: 'error',
        title: 'Oops...',
        text: 'Please select a size before adding to cart!',
      });
      return;  
    }

    console.log("This is the selected size:", Cartsize);

    fetch("/addto_cart", {
      method: "POST",
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ productId, quantity, Salesprice, stock, Cartsize }),
    })
    .then(response => response.json())
    .then(data => {
      Swal.fire({
        icon: data.alertType || 'success', 
        title: data.alertTitle || 'Success',
        text: data.alertText || data.message,
      });
    })
    .catch(error => {
      Swal.fire({
        icon: 'error',
        title: 'Oops...',
        text: 'Something went wrong!',
      });
      console.error("Error adding product to cart:", error);
    });
  });
});
    
    
// quentity button adjuste


let count = 1;
const countDisplay = document.getElementById('countDisplay');
const incrementBtn = document.getElementById('incrementBtn');
const decrementBtn = document.getElementById('decrementBtn');

function updateDisplay() {
    countDisplay.textContent = count;
}

updateDisplay();

incrementBtn.addEventListener('click', () => {
    if (count < 5) {
        count++;
        updateDisplay();
    }
});

decrementBtn.addEventListener('click', () => {
    if (count > 1) { 
        count--;
        updateDisplay();
    }
});



    
</script>
    
