<!DOCTYPE html>
<html lang="en">
  <%- include("../layouts/admin/admin_header.ejs") %>

  <body>
    <%- include("../layouts/admin/slidbar.ejs") %>

    <main class="main-wrap">
      <%- include("../layouts/admin/navbar.ejs") %>

      <section class="content-main">
        <div class="content-header">
            <div>
                <h2 class="content-title card-title">Coupons List </h2>
                <p>All available Coupons listed  here.</p>
            </div>
            <div>
                <div>
                    <a href="/loadcreateoffer" class="btn btn-primary"
                      ><i class="text-muted material-icons md-post_add"></i>Create New offer</a
                    >
                  </div>
            </div>
        </div>


        <div class="card">
            <div class="card-body">

                <div class="col-lg-8">
                    <ul class="nav nav-tabs mb-4" id="profileTabs" role="tablist">
                      <li class="nav-item" role="presentation">
                        <button
                          class="nav-link active"
                          id="details-tab"
                          data-bs-toggle="tab"
                          data-bs-target="#details"
                          type="button"
                          role="tab"
                        >
                          Coupons List
                        </button>
                      </li>
                      <li class="nav-item" role="presentation">
                        <button
                          class="nav-link"
                          id="addresses-tab"
                          data-bs-toggle="tab"
                          data-bs-target="#addresses"
                          type="button"
                          role="tab"
                        >
                          Create new coupons
                        </button>
                      </li>
                    </ul>
                    <div style="width: 1300px;"  class="tab-content" id="profileTabsContent">
                      <div  class="tab-pane fade show active" id="details" role="tabpanel">
                        <div class="card shadow-sm">
                          <div class="card-body">
                            <h5 class="card-title mb-4">Available coupons</h5>
                                <div class="card mb-4">
                                    <header class="card-header">
                                        <div class="row gx-3">
                                            <div class="col-lg-4 col-md-6 me-auto">
                                            </div>
                                            <div class="col-lg-2 col-6 col-md-3">
                                                <select class="form-select">
                                                    <option>Status</option>
                                                    <option>Active</option>
                                                    <option>Disabled</option>
                                                    <option>Show all</option>
                                                </select>
                                            </div>
                                        </div>
                                    </header> 
                                    <div class="card-body">
                                      <div class="table-responsive">
                                          <table class="table table-hover table-bordered align-middle">
                                              <thead>
                                                  <tr>
                                                      <!-- <th>#ID</th> -->
                                                      <th scope="col">Name</th>
                                                      <th scope="col">Offer (%)</th>
                                                      <th scope="col">Coupon Code</th>
                                                      <th scope="col">Status</th>
                                                      <th scope="col">Minimun amount</th>
                                                      <th scope="col">Maxmium amount</th>
                                                      <th scope="col">Action</th>
                                                  </tr>
                                              </thead>
                                                          <% coupondata.forEach((coupondata)=>{ %>
                                                          <tr>
                                                              <!-- <td><%=coupondata._id %></td> -->
                                                              <td><%=coupondata.couponName %></td>
                                                              <td><b><%=coupondata.couponDiscount %></b></td>
                                                              <td><%=coupondata.couponCode  %></td>
                                                              <% if(coupondata.couponStatus == true){ %>
                                                              <td><span class="badge rounded-pill alert-success">Active</span></td>
                                                              <% }else { %>
                                                              <td><span class="badge rounded-pill alert-success">Active</span></td>
                                                              <% } %>
                                                              <td><%=coupondata.minAmount  %></td>
                                                              <td><%= coupondata.maxAmount %></td>
                                                              <td class="text-end">
                                                                  <div class="dropdown">
                                                                      <a href="#" data-bs-toggle="dropdown" class="btn btn-light rounded btn-sm font-sm"> 
                                                                          <i class="material-icons md-more_horiz"></i> 
                                                                      </a>
                                                                      <div class="dropdown-menu dropdown-menu-end">
                                                                          <a class="dropdown-item" href="/load_editcoupon?id=<%=coupondata._id %>">Edit info</a>
                                                                          <form method="post" action="/remove_coupons?id=<%=coupondata._id %>">
                                                                          <button  class="dropdown-item text-danger">Remove</button>
                                                                          </form>
                                                                      </div>
                                                                  </div>
                                                              </td>
                                                          </tr>
                                                        <% }) %>
                                              </tbody>
                                          </table>
                                      </div>
                                  </div>
                                </div> 
                                
                            </div>
                        </div>
                      </div>
          
                      <!-- Addresses Tab -->
                      <div style="width: 800px; margin: 0 auto;" class="tab-pane fade" id="addresses" role="tabpanel">
                        <div class="d-flex justify-content-center">
                          <div class="card shadow-sm" style="width: 100%;">
                            <div class="card-body">
                              <h5 class="card-title mb-4 text-center">Create Coupons</h5>
                              <div class="card mb-3">
                                <div class="card-body">
                                  <h6 class="card-subtitle mb-2 text-muted text-center"></h6>
                                  <p class="card-text text-center"></p>
                                  <form method="post" action="/add_coupon"  onsubmit="return ">
                                    <div class="mb-4">
                                      <label class="form-label">Coupon Name</label>
                                      <input name="couponName" type="text" class="form-control" placeholder="Enter offer name" id="couponName" required />
                                      <span id="errorCouponName" class="text-danger"></span>
                                    </div>
                                  
                                    <div class="mb-4">
                                      <label class="form-label">Description</label>
                                      <textarea name="couponDescription" class="form-control" id="couponDescription" placeholder="Enter description"></textarea>
                                      <span id="errorCouponDescription" class="text-danger"></span>
                                    </div>
                                  
                                    <div class="mb-4">
                                      <label class="form-label">Coupon Code</label>
                                      <input name="couponCode" type="text" class="form-control" placeholder="Enter coupon code" id="couponCode" required />
                                      <span id="errorCouponCode" class="text-danger"></span>
                                    </div>
                                  
                                    <div class="mb-4">
                                      <label class="form-label">Discount Percentage</label>
                                      <input name="couponDiscount" type="number" class="form-control" placeholder="Enter discount percentage" id="couponDiscount"  />
                                      <span id="errorCouponDiscount" class="text-danger"></span>
                                    </div>
                                  
                                    <div class="mb-4">
                                      <label class="form-label">Max Amount</label>
                                      <input name="maxAmount" type="number" class="form-control" placeholder="Enter maximum discount amount" id="maxAmount"  />
                                      <span id="errorMaxAmount" class="text-danger"></span>
                                    </div>
                                  
                                    <div class="mb-4">
                                      <label class="form-label">Min Amount</label>
                                      <input name="minAmount" type="number" class="form-control" placeholder="Enter minimum purchase amount" id="minAmount"  />
                                      <span id="errorMinAmount" class="text-danger"></span>
                                    </div>
                                  
                                  
                                    <div class="mb-4">
                                      <label class="form-label">Users Limit</label>
                                      <input name="userlimint" type="text" class="form-control" id="catofrstartdate" placeholder="Enter Users limint" />
                                      <span id="erroruserlimit" class="text-danger"></span>
                                    </div>
                                  
                                  
                                    <div class="text-center">
                                      <button type="submit" class="btn btn-md rounded font-sm hover-up">Save Coupon</button>
                                    </div>
                                  </form>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </section> 


      
      

      <%- include("../layouts/admin/admin_footer.ejs") %>


    </main>
    <!-- content-main end// -->
    <script src="assets/js/vendors/jquery-3.6.0.min.js"></script>
    <script src="assets/js/vendors/bootstrap.bundle.min.js"></script>
    <script src="assets/js/vendors/select2.min.js"></script>
    <script src="assets/js/vendors/perfect-scrollbar.js"></script>
    <script src="assets/js/vendors/jquery.fullscreen.min.js"></script>
    <script src="assets/js/vendors/chart.js"></script>

    <script src="assets/js/main.js" type="text/javascript"></script>
    <script src="assets/js/custom-chart.js" type="text/javascript"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

        
    <script>
  const message = "<%= message %>";
  const type = "<%= type %>";

      if (message && message.length > 0) {
          Swal.fire({
            icon: type, // 'success', 'error', 'warning', 'info'
          title: message,
          showConfirmButton: true,
          toast: true,
          position: "top-end",
          showConfirmButton: false,
          timerProgressBar: true,
          timer: 3000,
          });
      }
  </script>

  <script>
    function validateCategoryOfferForm() {
        let isValid = true;
        const offerName = document.getElementById("catofrname");
        const description = document.getElementById("catofrdescription");
        const category = document.getElementById("catofrid");
        const discountPercentage = document.getElementById("catofrpercentage");
        const startDate = document.getElementById("catofrstartdate");
        const expiryDate = document.getElementById("catofrenddate");
    
        document.getElementById("errorCatOfferName").textContent = "";
        document.getElementById("errorCatDescription").textContent = "";
        document.getElementById("errorCatCategory").textContent = "";
        document.getElementById("errorCatDiscount").textContent = "";
        document.getElementById("errorCatStartDate").textContent = "";
        document.getElementById("errorCatExpiryDate").textContent = "";
    
        if (offerName.value.trim() === "") {
            document.getElementById("errorCatOfferName").textContent = "Offer name is required.";
            isValid = false;
        }
    
        if (description.value.trim() === "") {
            document.getElementById("errorCatDescription").textContent = "Description is required.";
            isValid = false;
        }
    
        if (category.value === "") {
            document.getElementById("errorCatCategory").textContent = "Please select a category.";
            isValid = false;
        }
    
        if (discountPercentage.value === "" || discountPercentage.value < 0 || discountPercentage.value > 100) {
            document.getElementById("errorCatDiscount").textContent = "Enter a discount between 0 and 100.";
            isValid = false;
        }
    
        if (startDate.value === "") {
            document.getElementById("errorCatStartDate").textContent = "Start date is required.";
            isValid = false;
        }
    
        if (expiryDate.value === "") {
            document.getElementById("errorCatExpiryDate").textContent = "Expiry date is required.";
            isValid = false;
        } else if (startDate.value && expiryDate.value && new Date(startDate.value) > new Date(expiryDate.value)) {
            document.getElementById("errorCatExpiryDate").textContent = "Expiry date cannot be earlier than start date.";
            isValid = false;
        }
    
        return isValid;
    }
    </script>






  </body>
</html>
